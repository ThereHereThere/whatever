local Rayfield=loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window=Rayfield:CreateWindow({Name='Sigma 67 Hub',Icon=0,LoadingTitle='Sigma 67 Hub',LoadingSubtitle='Noob',ShowText='Rayfield',Theme='Default',ToggleUIKeybind='K',ConfigurationSaving={Enabled=true,FolderName=nil,FileName='sigmafisch_v6'},KeySystem=false})
local MiscTab=Window:CreateTab('Misc Tab',4483362458)
local MainTab=Window:CreateTab('Main Tab',4483362458)
local Players=game:GetService('Players')
local LocalPlayer=Players.LocalPlayer
local PlayerGui=LocalPlayer:WaitForChild('PlayerGui')
local VirtualInputManager=game:GetService('VirtualInputManager')
local VirtualUser=game:GetService('VirtualUser')
local RunService=game:GetService('RunService')
local GuiService=game:GetService('GuiService')
local AutoFarmEnabled,autoCastEnabled,autoShakeEnabled,autoReelEnabled,autoAfkEnabled=false,false,false,false,false
local autoShakeConnection,autoReelConnection,autoAfkConnection
local ReelMode='Legit'
local ShakeMode='Navigation'

local function udim2_add(u,dx,dy)return UDim2.new(u.X.Scale,u.X.Offset+dx,u.Y.Scale,u.Y.Offset+dy)end

local function startAutoCast()
    task.spawn(function()
        while autoCastEnabled do
            local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local tool=char:FindFirstChildOfClass('Tool')
            if tool and not tool:FindFirstChild('bobber')then
                VirtualInputManager:SendMouseButtonEvent(0,0,0,true,LocalPlayer,0)
                task.wait(0.2)
                VirtualInputManager:SendMouseButtonEvent(0,0,0,false,LocalPlayer,0)
            end
            task.wait(0.5)
        end
    end)
end

local function autoShake()
    local shakeui=PlayerGui:FindFirstChild('shakeui')
    local button=shakeui and shakeui.safezone and shakeui.safezone:FindFirstChild('button')
    if button then
        GuiService.SelectedObject=button
        VirtualInputManager:SendKeyEvent(true,Enum.KeyCode.Return,false,game)
        VirtualInputManager:SendKeyEvent(false,Enum.KeyCode.Return,false,game)
        task.wait(0.1)
        GuiService.SelectedObject=nil
    end
end

local function startAutoShake()
    if autoShakeConnection or not autoShakeEnabled then return end
    autoShakeConnection=RunService.RenderStepped:Connect(autoShake)
end

local function stopAutoShake()
    if autoShakeConnection then autoShakeConnection:Disconnect() autoShakeConnection=nil end
end

local function autoReelUpdate()
    local reel=PlayerGui:FindFirstChild('reel')
    if not reel then return end
    local bar=reel:FindFirstChild('bar')
    local playerbar=bar and bar:FindFirstChild('playerbar')
    local fish=bar and bar:FindFirstChild('fish')
    if playerbar and fish then playerbar.Position=fish.Position end
end

local function startAutoReel()
    if autoReelConnection or not autoReelEnabled then return end
    autoReelConnection=RunService.RenderStepped:Connect(function()if autoReelEnabled then autoReelUpdate() end end)
end

local function stopAutoReel()
    if autoReelConnection then autoReelConnection:Disconnect() autoReelConnection=nil end
end

local function autoAfk()
    if autoAfkConnection then autoAfkConnection:Disconnect() end
    autoAfkConnection=task.spawn(function()
        while autoAfkEnabled do
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
            pcall(function() game.ReplicatedStorage.events.afk:FireServer(false) end)
            task.wait(0.01)
        end
    end)
end

MiscTab:CreateToggle({Name='Loot FischFest?',CurrentValue=false,Flag='FischFestFarm',Callback=function(Value)
    AutoFarmEnabled=Value
    if Value then
        local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp=char:WaitForChild('HumanoidRootPart')
        hrp.CFrame=CFrame.new(935.9,131.7,9917.5)
        task.spawn(function()
            while AutoFarmEnabled do
                char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
                hrp=char:FindFirstChild('HumanoidRootPart')
                if hrp then
                    for _,v in ipairs(workspace.world.map.FischFest.Shore:GetDescendants()) do
                        if not AutoFarmEnabled then break end
                        if v:IsA('ProximityPrompt') and v.Name=='Prompt' then
                            local parent=v.Parent
                            if parent and parent:IsA('Model') and parent.PrimaryPart then
                                hrp.CFrame=parent.PrimaryPart.CFrame+Vector3.new(0,3,0)
                                task.wait(0.15)
                            end
                            pcall(function() fireproximityprompt(v,v.HoldDuration) end)
                            task.wait(0.3)
                        end
                    end
                end
                task.wait(1.5)
            end
        end)
    end
end})

local StarToggle=MiscTab:CreateToggle({Name='Teleport to StarFall',CurrentValue=false,Flag='StarFallFinder',Callback=function(Value)
    if Value then
        local crater=workspace:FindFirstChild('StarCrater')
        if crater and crater.PrimaryPart then
            local char=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local hrp=char:FindFirstChild('HumanoidRootPart')
            hrp.CFrame=crater.PrimaryPart.CFrame+Vector3.new(0,5,0)
            Rayfield:Notify({Title='StarFall Finder',Content='Teleported to StarCrater!',Duration=2,Image=4483362458})
        else
            Rayfield:Notify({Title='StarFall Finder',Content='No StarFall is currently active.',Duration=2,Image=4483362458})
        end
        task.delay(0.1,function() if StarToggle then StarToggle:Set(false) end end)
    end
end})

MiscTab:CreateToggle({Name='Auto AFK',CurrentValue=false,Flag='AutoAFK',Callback=function(Value)
    autoAfkEnabled=Value
    if Value then autoAfk() elseif autoAfkConnection then autoAfkConnection:Disconnect() end
end})

MainTab:CreateToggle({Name='Auto Cast (Legit)',CurrentValue=false,Flag='AutoCast',Callback=function(Value)
    autoCastEnabled=Value
    if Value then startAutoCast() end
end})

MainTab:CreateToggle({Name='Auto Shake (Navigation)',CurrentValue=false,Flag='AutoShake',Callback=function(Value)
    autoShakeEnabled=Value
    if Value then startAutoShake() else stopAutoShake() end
end})

MainTab:CreateToggle({Name='Auto Reel',CurrentValue=false,Flag='AutoReel',Callback=function(Value)
    autoReelEnabled=Value
    if Value then startAutoReel() else stopAutoReel() end
end})
